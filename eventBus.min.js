!function(t,e){var s="CreatePostMessageEventBus";"object"==typeof exports&&"object"==typeof module?module.exports[s]=e():"function"==typeof define&&(define.amd||define.cmd)?define(e):"object"==typeof exports?exports[s]=e():t&&(t[s]=e())}(this,function(){"use strict";var e;function s(t){this.options=t,this.sources=[],this.postMessageCenter=new n,this.postMessageCenter.watch(this.handler.bind(this))}function n(){this.watch=function(e){window.addEventListener("message",function(t){e(t)})},this.send=function(t,e,s){t.postMessage(e,s||"*")},this.EventData=t}function t(t,e){if(!this.valid(t))throw new Error("type is not correct");this.type=t,this.data=e}function o(t,e,s){t.on=t.on||[],t.emit=t.emit||[],this.eventNames=t,this.origin=e,this.source=s}return s.prototype.handler=function(s){var n=this;if(window===window.top)switch(s.data.type){case"REGISTER":this.sources.push(new o(s.data.data.eventNames,s.origin,s.source)),this.postMessageCenter.send(s.source,new this.postMessageCenter.EventData("REGISTER-SUCCESS")),this.sources.forEach(function(e){e.eventNames.on.forEach(function(t){s.data.data.eventNames.emit.indexOf(t)&&n.postMessageCenter.send(e.source,new n.postMessageCenter.EventData("EMIT",t))})});break;case"PUSH":var e=s.data.data.name;this.sources.forEach(function(t){-1<t.eventNames.on.indexOf(e)&&n.postMessageCenter.send(t.source,s.data)})}else switch(s.data.type){case"REGISTER-SUCCESS":this.options.success&&"function"==typeof this.options.success&&this.options.success.call(this);break;case"PUSH":this.options.receive&&"function"==typeof this.options.receive&&this.options.receive.call(this,s.data.data);break;case"EMIT":this.options.request&&"function"==typeof this.options.request&&this.options.request.call(this,s.data.data)}},s.prototype.init=function(){this.postMessageCenter.send(window.top,new this.postMessageCenter.EventData("REGISTER",{eventNames:{on:this.options.on||[],emit:this.options.emit||[]}}))},s.prototype.send=function(t){this.postMessageCenter.send(window.top,new this.postMessageCenter.EventData("PUSH",t))},t.prototype.EVENTS=["REGISTER","REGISTER-SUCCESS","PUSH","EMIT"],t.prototype.valid=function(t){return-1<this.EVENTS.indexOf(t)},function(t){return e||((e=new s(t)).init(),e)}});